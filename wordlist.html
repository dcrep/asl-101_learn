<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ASL Learning Practice</title>
</head>

<body onload="pageLoaded()">
    <h1>ASL-101 Powerpoint Links Compilation (Christine Chynoweth)</h1>
    <a href="./index.html">Back to Index</a>
    <h2>Complete Compiled Links, Week 1-7, Units 1-4 (JSON, dynamic)</h2>
    <p id="filters">
        <form action="" method="get" class="form-example" autocomplete="off"></form>
            <h3>
                Filters: &nbsp;
        
            <input type="checkbox" id="exlinks" checked><label for="extraLinks">Extra/Added Links</label> &nbsp;
            <input type="checkbox" id="unit1" checked><label for="unit1Links">Unit 1</label> &nbsp;
            <input type="checkbox" id="unit2" checked><label for="unit2Links">Unit 2</label> &nbsp;
            <input type="checkbox" id="unit3" checked><label for="unit3Links">Unit 3</label> &nbsp;
            <input type="checkbox" id="unit4" checked><label for="unit4Links">Unit 4</label> &nbsp;            
            <br>
            Order: &nbsp;
            <input type="checkbox" id="byunit" checked disabled><label for="byUnit">Unit-Day Order</label> &nbsp;
            <input type="checkbox" id="byalphanum"><label for="byAlphaNum">Alphabetical Order</label> &nbsp;
            <input type="checkbox" id="randomize"><label for="randomizeLinks">Randomize</label> &nbsp;
            
        </form>
    </h3>
    </p>
    <div id="output">

    </div>
    <script>
        let original_links_array = [];
        let extra_link_checked = true;
        let filter_change = false;
        let randomized = false;
        let alpha_sort = false;
        // 0-indexed units (1 = 0, 2 = 1, ... 8 = 7)
        let unit_ids_checked = [true, true, true, true, true, true, true, true];
        const extraLinks = document.getElementById('exlinks');
        extra_link_checked = extraLinks.checked;
        extraLinks.addEventListener('change', (event) => {
            if (event.currentTarget.checked) // Checkbox is checked
                extra_link_checked = true;
            else    // Checkbox is unchecked                
                extra_link_checked = false;
            writeFilteredList();
        });

        const unitSort = document.getElementById('byunit');
        const alphaSort = document.getElementById('byalphanum');
        const randomSort = document.getElementById('randomize');

        alphaSort.addEventListener('change', (event) => {
            if (event.currentTarget.checked) { // Checkbox is checked
                alpha_sort = true;
                randomized = false;
                randomSort.checked = false;
                unitSort.checked = false;
            } else {   // Checkbox is unchecked                
                alpha_sort = false;
                unitSort.checked = true;
                // This shouldn't be needed if logic works out:
                //randomSort.checked = false;
            }
            writeFilteredList();
        });
        
        randomSort.addEventListener('change', (event) => {
            if (event.currentTarget.checked) { // Checkbox is checked
                randomized = true;
                alpha_sort = false;
                alphaSort.checked = false;
                unitSort.checked = false;
            } else {   // Checkbox is unchecked                
                randomized = false;
                unitSort.checked = true;
                // This shouldn't be needed if logic works out:
                //alphaSort.checked = false;
            }
            writeFilteredList();
        });

        document.getElementById('unit1').addEventListener('change', unitCheckBoxClicked);
        document.getElementById('unit2').addEventListener('change', unitCheckBoxClicked);
        document.getElementById('unit3').addEventListener('change', unitCheckBoxClicked);
        document.getElementById('unit4').addEventListener('change', unitCheckBoxClicked);

        function unitCheckBoxClicked(event) {
            const checkbox_id = event.target.id;
            const id_num = Number(checkbox_id.charAt(checkbox_id.length - 1));
            //console.log("event.target.id=" + checkbox_id + ", number = " + id_num);
            if (event.currentTarget.checked)
                unit_ids_checked[id_num - 1] = true;
            else
                unit_ids_checked[id_num - 1] = false;

            writeFilteredList();
        }
        /* "How to randomize (shuffle) a JavaScript array? - Stack Overflow"
            answer by Laurens Holst @ https://stackoverflow.com/a/12646864/23514245
        */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function writeFilteredList() {
            const elem = document.getElementById("output")
            //data = JSON.parse(data);  // unnecessary
            //links_array = data.items;
            let links_array = original_links_array.slice(); // or "links_array = [...original_links_array];"
            if (randomized) {
                shuffleArray(links_array);
            } else if (alpha_sort) {
                links_array.sort( (a, b) => {
                    // replace these characters:  ':', '\', '/', ' ', '-'
                    const regex = /[\/\-\\:\s]/gi;
                    const aLower = a.text.toLowerCase().replace(regex, '');
                    const bLower = b.text.toLowerCase().replace(regex, '');                    
                    if (aLower < bLower) { return -1; }
                    if (aLower > bLower) { return 1; }
                    return 0;
                });
            }
            let listHTML = "<ul style=\"line-height:125%\">";
            // for..of loop (rather than for..in!)
            for (let obj of links_array) {
                let include_item = true;
                const unit_id = obj.unitid;
                const unit_number = Number(unit_id.charAt(1));
                if (unit_id.endsWith("x") && !extra_link_checked)
                    include_item = false;
                else if (!unit_ids_checked[unit_number - 1])
                    include_item = false;
                if (include_item)
                    listHTML += "<li> <a href=\"" + obj.link + "\">" + obj.text + "</a> " + obj.extra + "</li>";
                //else
                //    console.log("Skipping " + obj.text + ", unitID " + obj.unitid);
            }
            // index iteration alternative (slower)
            //for (let i = 0; i < links_array.length; i++)
            //{
            //console.log("#" + i + ": " + data.items[i].text + ", URL: " + data.items[i].link);
            //"<li> <a href=\"" + data.items[i].link + "\">" + data.items[i].text + "</a> " + data.items[i].extra + "</li>";
            //data.items[i].unitid  // U#D#
            //}
            listHTML += "</ul>";
            elem.innerHTML = listHTML;
        }
        function pageLoaded() {
            //let original_links_array = [];
            fetch("link_dump/week1-7-output.json")
                .then((res) => {
                    if (!res.ok) {
                        throw new Error
                            (`HTTP error! Status: ${res.status}`);
                    }
                    return res.json();
                })
                .then((data) => {
                    const elem = document.getElementById("output")
                    //data = JSON.parse(data);  // unnecessary
                    original_links_array = data.items;
                    writeFilteredList();
                })
                .catch((error) =>
                    console.error("Unable to fetch data:", error));
            console.log("Loaded!" + new Date() + document.getElementById("unit1").checked);
        }
        //fetchJSONData();
    </script>
</body>
<a href="./index.html">Back to Index</a>

</html>